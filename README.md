# Микросервис, собирающий, хранящий и отображающий стоимости криптовалют.

#### `/currency/add` - Добавление криптовалюты в список наблюдения
#### `/currency/remove` - Удаление криптовалюты из списка наблюдения

Добавление криптовалюты в список наблюдения подразумевает что мы собираем и записываем цену криптовалюты в локальную базу раз в N секунд. Удаление из этого списка останавливает сбор цены. Для получения актуальной цены можно воспользоваться открытыми API.

#### `/currency/price` - Получение цены криптовалюты

Должна быть возможность получить цену конкретной криптовалюты в конкретный момент времени из локальной базы. Например: на запрос {"coin": "BTC", "timestamp": 1736500490}, сервис должен вернуть стоимость BTC в момент времени 1736500490. Если не удалось найти стоимость в конкретный момент времени, возвращаем стоимость в ближайший к запрошенному моменту времени.

Приложение должно быть упаковано в Docker Compose. В качестве базы необходимо использовать Postgres. 

### Необходимые пререквизиты - установленный Docker.

## Инструкция по запуску:

#### 1. Создать файл .env и изменить параметры по своему усмотрению. Можно просто скопировать .env.example; ключ для взаимодействия с API можно оставить таким, какой он есть. 

```bash
cp .env.example .env
```

#### 2. Поднять docker-compose. Он состоит из 3 контейнеров: 

- currency-service - наш основной компонент в котором поднимается HTTP-сервер и Observer. Будет доступен в локальной сети по адресу http://localhost:8080. К swagger можно обратиться по /, он автоматически перенаправит на страницу swagger UI. Все сущности так же описаны в этом файле.

- db - контейнер postgres, в нем будет единственная таблица - price.

- migrate - контейнер для поднятия миграций. Как только он выполнит свою работу, он завершится.

```bash
docker compose up --remove-orphans
```

После поднятия контейнера будет будет выводиться информация по необходимым валютам каждые OBSERVE_TIME (переменная окружения в файле .env) секунд.

#### Регистрировать новые валюты для наблюдения можно с помощью ендпоинта по адресу `/api/v1/currency/add/{coin}`

#### Удалять валюты из списка наблюдения можно с помощью ендпоинта по адресу `/api/v1/currency/remove/{coin}`

#### Получить цену валюты в конкретный момент времени (или самый ближайший к этому моменту времени) можно с помощью ендпоинта по адресу `/api/v1/currency/price/{coin}/{timestamp}`


## Пример взаимодействия в формате видео представлен в виде ссылки на google drive: 

### https://drive.google.com/file/d/1ZS69ltEls_4dWEcgrXyDJIQNzN_QqbJc/view?usp=sharing


#
#
#

##### Настройки линтера лежат в файле конфигурации .golangci.yml
##### При желании можно настроить .gitlab-ci.yml для деплоя сервиса
##### Миграции описаны в каталоге migrations.
##### В качестве API для получения валют выбран сервис https://api-ninjas.com/api/cryptoprice. При желании можно выбрать любой другой и переписать две вещи: coinAPI файл и структуру возвращаемого значения.